# Copyright 2021 Piotr Tutak

# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at

#     http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

FLINK_REST_PORT: 8090

FLINK_JOBMANAGER_RPC_PORT: 6101
FLINK_BLOB_SERVER_PORT: 6102
FLINK_HISTORYSERVER_WEB_PORT: 8100

FLINK_TASKMANAGER_RPC_PORT: 6201
FLINK_TASKMANAGER_DATA_PORT: 6202

FLINK_RESOURCEMANAGER_RPC_PORT: "{{ FLINK_JOBMANAGER_RPC_PORT }}"

FLINK_HIGH_AVAILABILITY_JOBMANAGER_PORT_LIST:
  - 7101
  - 7102
  - 7103
  - 7104
  - 7105

FLINK_METRICS_INTERNAL_QUERY_SERVICE_PORT_LIST:
  - 7201
  - 7202
  - 7203
  - 7204
  - 7205

FLINK_HIGH_AVAILABILITY_JOBMANAGER_PORT: "{{ FLINK_HIGH_AVAILABILITY_JOBMANAGER_PORT_LIST | join(',') }}"

FLINK_HIGH_AVAILABILITY_JOBMANAGER_PORTS: "[
{%- for port in FLINK_HIGH_AVAILABILITY_JOBMANAGER_PORT_LIST[:-1] -%}
'{{ port }}/tcp',
{%- endfor -%}
'{{ FLINK_HIGH_AVAILABILITY_JOBMANAGER_PORT_LIST[-1] }}/tcp'
]"

FLINK_METRICS_INTERNAL_QUERY_SERVICE_PORT: "{{ FLINK_METRICS_INTERNAL_QUERY_SERVICE_PORT_LIST | join(',') }}"

FLINK_METRICS_INTERNAL_QUERY_SERVICE_PORTS: "[
{%- for port in FLINK_METRICS_INTERNAL_QUERY_SERVICE_PORT_LIST[:-1] -%}
'{{ port }}/tcp',
{%- endfor -%}
'{{ FLINK_METRICS_INTERNAL_QUERY_SERVICE_PORT_LIST[-1] }}/tcp'
]"

FLINK_COMMON_PORTS:
  - "{{ FLINK_JOBMANAGER_RPC_PORT }}/tcp"
  - "{{ FLINK_BLOB_SERVER_PORT }}/tcp"
  - "{{ FLINK_REST_PORT }}/tcp"
  - "{{ FLINK_TASKMANAGER_RPC_PORT }}/tcp"
  - "{{ FLINK_TASKMANAGER_DATA_PORT }}/tcp"
  - "{{ FLINK_RESOURCEMANAGER_RPC_PORT }}/tcp"

FLINK_PORTS: "{{ FLINK_COMMON_PORTS + FLINK_HIGH_AVAILABILITY_JOBMANAGER_PORTS + FLINK_METRICS_INTERNAL_QUERY_SERVICE_PORTS }}"

FLINK_JOBMANAGER_WEB_PORTS: "[
{%- for port in FLINK_JOBMANAGER_WEB_PORT[:-1] -%}
'{{ port }}/tcp',
{%- endfor -%}
'{{ FLINK_JOBMANAGER_WEB_PORT[-1] }}/tcp'
]"

FLINK_HISTORYSERVER_WEB_PORTS:
  - "{{ FLINK_HISTORYSERVER_WEB_PORT }}/tcp"


FLINK_MASTER_PORTS: "{{ FLINK_JOBMANAGER_WEB_PORTS + FLINK_HISTORYSERVER_WEB_PORTS }}"

FLINK_WORKERS: "[
{%- for host in groups['flink'][:-1] -%}
{%- if host != FLINK_MASTER -%}
'{{ hostvars[host]['ansible_host'] }}',
{%- endif -%}
{%- endfor -%}
{%- if groups['flink'][-1] != FLINK_MASTER -%}
'{{ hostvars[groups['flink'][-1]]['ansible_host'] }}'
{%- endif -%}
]
"
